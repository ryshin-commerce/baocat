"use strict";function FileUpload(){this.InputElement=null,this.PreviewBoxElement=null,this.CurentImageBox=null,this.Form=null,this.MaxFile=null,this.StoredFiles=[],this.CurentFiles=[],this.Extend=function(e,t,a,n,o,l,r){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d=arguments.length>8&&void 0!==arguments[8]&&arguments[8],i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"";this.InputElement=a,this.PreviewBoxElement=o,this.CurentImageBox=n,this.Form=l,this.UniqueControlName=i,this.MaxFile=r||2,this.InputChangeCallBack=s,this.InputElement.addEventListener("change",this.InputChange),this.InputElement.fileUpload=this,this.FileReader=new FileReader,this.IsCreateInputName=d,this.HostCdn=e||"",this.CurentFiles=t||[],this.Process()},this.Process=function(){if(this.CurentImageBox){var e=this;this.CurentFiles.forEach(function(t){var a=document.createElement("div");a.className="col-3 gutter-10 _p-item";var n=document.createElement("figure");n.className="_max-height-200 relative hover-children-show";var o=document.createElement("button");o.className="absolute hide tablet-show -border width-100 height-100 _fill-silver-opacity text-strong",o.innerText="CLICK ĐỂ XÓA",o.type="button",o.dataset.file=t,o.addEventListener("click",function(t){e.RemoveCurentFile(t,e.InputElement)});var l=t.substring(t.lastIndexOf("/")+1),r="<img class='width-100' src='"+e.HostCdn+t+"' alt='"+l+"' data-file='"+l+"' /><figcaption class='padding-5 text-center _text-ellipsis'>"+l+"</figcaption>";if(e.IsCreateInputName){var s="<input type='text' class='_hidden' name='CurentFilePaths"+e.UniqueControlName+"[]' value="+t+"></input>";r+=s}n.innerHTML=r,n.insertBefore(o,n.childNodes[0]),a.appendChild(n),e.CurentImageBox.appendChild(a)})}},this.InputChange=function(e){var t=e.target.fileUpload,a=e.target.files,n=Array.prototype.slice.call(a);t.PreviewBoxElement.innerHTML="",t.StoredFiles=[],n.forEach(function(e){if(e.type.match("image.*")&&(t.StoredFiles.push(e),t.PreviewBoxElement===t.CurentImageBox&&(t.CurentFiles=[],t.CurentImageBox.innerHTML=""),t.StoredFiles.length+t.CurentFiles.length<=t.MaxFile)){var a=new FileReader;a.onload=function(a){var n=document.createElement("div");n.className="col-3 gutter-10 _p-item";var o=document.createElement("figure");o.className="_max-height-200 relative hover-children-show";var l=document.createElement("button");l.className="absolute hide -border width-100 height-100 _fill-silver-opacity text-strong",l.type="button",l.innerText="CLICK ĐỂ XÓA",l.dataset.file=e.name,l.addEventListener("click",function(e){t.RemoveFile(e,t.InputElement)});var r="<img class='width-100' src='"+a.target.result+"' alt='"+e.name+"' data-file='"+e.name+"' /><figcaption class='padding-5 text-center _text-ellipsis'>("+e.size%1e3+" kb) "+e.name+"</figcaption>";if(t.IsCreateInputName){var s="<input type='text' class='_hidden' name='NewFiles"+t.UniqueControlName+"[]' value="+e.name+"></input>";r+=s}o.innerHTML=r,o.insertBefore(l,o.childNodes[0]),n.appendChild(o),t.PreviewBoxElement.appendChild(n)},a.readAsDataURL(e)}}),t.InputChangeCallBack&&t.InputChangeCallBack(t.StoredFiles)},this.RemoveCurentFile=function(e){for(var t=e.target.dataset.file,a=0;a<this.CurentFiles.length;a++)if(this.CurentFiles[a]===t){this.CurentFiles.splice(a,1);break}var n=Site.FindParent(e.target,"_p-item");n.remove()},this.RemoveFile=function(e,t){for(var a=e.target.dataset.file,n=0;n<this.StoredFiles.length;n++)if(this.StoredFiles[n].name===a){this.StoredFiles.splice(n,1);break}var o=Site.FindParent(e.target,"_p-item");o.remove(),Site.ClearInputFile(t)},this.Init=function(e,t,a,n,o,l,r,s,d,i){var u=document.querySelector(a),c=document.querySelector(o),p=document.querySelector(n),m=document.querySelector(l);null!=u&&null!=c||console.warn(a+" or "+c+": NULL"),this.Extend(e,t,u,p,c,m,r,s,d,i)}}function init(){streetAddress=document.getElementById("RealStreetAddress"),realAddress=document.getElementById("RealAddress"),autoCompleteAddress=document.getElementById("DisplayFullAddress"),locationId=document.getElementById("LocationId"),price=document.getElementById("Price"),lbPriceDisplay=document.getElementById("lbPriceDisplay"),lbAddress=document.getElementById("lbAddress"),displayAddressLat=document.getElementById("DisplayAddressLat"),displayAddressLng=document.getElementById("DisplayAddressLng"),geoComponent=document.getElementById("GeoComponent"),selectedPropertyType=document.getElementById("SelectedPropertyType"),notes=document.getElementById("Notes"),btnGetMyLocation=document.getElementById("btnGetMyLocation"),lbHomeSize=document.querySelector("[for=HomeSize]"),price.addEventListener("keyup",function(e){var t=+moneyCleave.getRawValue();t?lbPriceDisplay.innerText=WNumbHelper.GetPrice(t,!1)+"/tháng":lbPriceDisplay.innerText=""}),streetAddress.addEventListener("keyup",function(e){updateAddress()},500),streetAddress.addEventListener("change",function(e){var t=[allTitleCase(streetAddress.value.trim()),realAddress.value].join(", ");GAddressMap.FirePlaceChange(t)}),realAddress.addEventListener("change",function(e){updateAddress()},500),autoCompleteAddress.addEventListener("keypress",function(e){var t=e.charCode||e.keyCode||0;13===t&&e.preventDefault()}),selectedPropertyType.addEventListener("change",function(e){lbHomeSize.innerText="Diện tích "+this.options[this.selectedIndex].text.toLowerCase();var t=document.querySelectorAll("[data-hide-on-rent-land]");Site.RemoveClass("[data-hide-on-rent-land]","hidden");for(var a=0;a<t.length;a++)t[a].value="";if("RentOrther"===e.target.value)lbHomeSize.innerText="Diện tích";else if("RentLand"===e.target.value){Site.AddClass("[data-hide-on-rent-land]","hidden");for(var n=0;n<t.length;n++)t[n].querySelector("input").value="1"}}),selectedPropertyType.dispatchEvent(new Site.CreateEvent("change")),btnGetMyLocation.addEventListener("click",function(e){Site.GetGeoLocation(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);GAddressMap.Map.setCenter(t)},function(){Site.NotifyFormFailed("THÔNG BÁO",'<p>Cho phép chúng tôi xác định vị trí của bạn.</p><img style="width: 100%;" src="/images/shared/enable-geo-location/'+Site.GetBrowserName()+'.png">')})})}function inputFileCallBack(e){}function updateAddress(){lbAddress.innerText="Hiển thị: "+[allTitleCase(streetAddress.value.trim()),realAddress.value].join(", "),autoCompleteAddress.value=[allTitleCase(streetAddress.value.trim()),realAddress.value].join(", ")}function selectionCallback081517(e,t,a){t&&(LocalStorageHelper.Save(LocalStogeEnum.SELECTED_LOCATION_STORAGE_NAME,{id:a,address:t.item.display}),locationId.value=a,console.log("locationId "+locationId),fuzzyComplete.GetPlaceDetail(a,function(e,t){if(200===+t){if(null!=e&&"null"!==e){var a=JSON.parse(e);GAddressMap.Map.setCenter(new google.maps.LatLng(a.locationLat,a.locationLng))}}else notify("THÔNG BÁO","Có lỗi xảy ra, không thể xác định được vị trí khu vực",!0,"error",null,!0)}))}function loadCleave(){moneyCleave=new Cleave("#Price",{numeral:!0,numeralThousandsGroupStyle:"thousand",numeralPositiveOnly:!0});new Cleave("#PosterMobile",{numericOnly:!0,delimiters:[".",".","."],blocks:[3,3,5]})}function LoadMap(){console.log("LoadMap"),window.onload=function(){var e=new Object;e.mapElementSelector="#map",e.autocompleteElementSelector="#DisplayFullAddress",e.mapChangeCallBack=MapChangeEndCallback,e.deaultLatLng=new google.maps.LatLng(NumberHelper.ToDouble(displayAddressLat.value),NumberHelper.ToDouble(displayAddressLng.value)),e.scrollwheel=!0,e.defaultZoom=17,e.minZoom=12,e.defaultAddress=realAddress.value,GAddressMap.Init(e),GAddressMap.LoadMap()}}function MapChangeEndCallback(e,t,a){a?(geoComponent.value=JSON.stringify(a),displayAddressLat.value=NumberHelper.ToFrDouble(e.lat()),displayAddressLng.value=NumberHelper.ToFrDouble(e.lng())):(geoComponent.value="",displayAddressLat.value=0,displayAddressLng.value=0)}function LoadEditor(){quill=new Quill("#editorNotes",{debug:"error",modules:{toolbar:toolbarOptions},placeholder:"Nhập nội dung html website...",theme:"snow",formats:{background:"white"}}),quill.on("editor-change",function(e){var t=quill.container.firstChild.innerHTML;notes.value=t})}!function(e){function t(e,t){for(var a=window,n=(e||"").split(".");a&&n.length;)a=a[n.shift()];return"function"==typeof a?a:(t.push(e),Function.constructor.apply(null,t))}function a(e){return"GET"===e||"POST"===e}function n(e,t){a(t)||e.setRequestHeader("X-HTTP-Method-Override",t)}function o(t,a,n){var o;a&&void 0!==a.isUpdateLayout&&!a.isUpdateLayout||n.indexOf("application/x-javascript")===-1&&(o=(t.getAttribute("data-ajax-mode")||"").toUpperCase(),e(t.getAttribute("data-ajax-update")).each(function(t,n){var l;switch(o){case"BEFORE":l=n.firstChild,e("<div />").html(a).contents().each(function(){n.insertBefore(this,l)});break;case"AFTER":e("<div />").html(a).contents().each(function(){n.appendChild(this)});break;case"REPLACE-WITH":e(n).replaceWith(a);break;default:e(n).html(a)}}))}function l(l,r){var s,d,i,u;s=l.getAttribute("data-ajax-confirm"),s&&!window.confirm(s)||(d=e(l.getAttribute("data-ajax-loading")),u=parseInt(l.getAttribute("data-ajax-loading-duration"),10)||0,e.extend(r,{type:l.getAttribute("data-ajax-method")||void 0,url:l.getAttribute("data-ajax-url")||void 0,cache:!!l.getAttribute("data-ajax-cache"),beforeSend:function(e){var a;return n(e,i),a=t(l.getAttribute("data-ajax-begin"),["xhr"]).apply(l,arguments),a!==!1&&d.show(u),a},complete:function(){d.hide(u),t(l.getAttribute("data-ajax-complete"),["xhr","status"]).apply(l,arguments),console.log("complete")},success:function(e,a,n){o(l,e,n.getResponseHeader("Content-Type")||"text/html"),t(l.getAttribute("data-ajax-success"),["data","status","xhr"]).apply(l,arguments),console.log("success")},error:function(){t(l.getAttribute("data-ajax-failure"),["xhr","status","error"]).apply(l,arguments),console.log("error")}}),r.data.push({name:"X-Requested-With",value:"XMLHttpRequest"}),i=r.type.toUpperCase(),a(i)||(r.type="POST",r.data.push({name:"X-HTTP-Method-Override",value:i})),e.ajax(r))}function r(t){var a=e(t).data(i);return!a||!a.validate||a.validate()}var s="unobtrusiveAjaxClick",d="unobtrusiveAjaxClickTarget",i="unobtrusiveValidation";e(document).on("click","a[data-ajax=true]",function(e){e.preventDefault(),l(this,{url:this.href,type:"GET",data:[]})}),e(document).on("click","form[data-ajax=true] input[type=image]",function(t){var a=t.target.name,n=e(t.target),o=e(n.parents("form")[0]),l=n.offset();o.data(s,[{name:a+".x",value:Math.round(t.pageX-l.left)},{name:a+".y",value:Math.round(t.pageY-l.top)}]),setTimeout(function(){o.removeData(s)},0)}),e(document).on("click","form[data-ajax=true] :submit",function(t){var a=t.currentTarget.name,n=e(t.target),o=e(n.parents("form")[0]);o.data(s,a?[{name:a,value:t.currentTarget.value}]:[]),o.data(d,n),setTimeout(function(){o.removeData(s),o.removeData(d)},0)}),e(document).on("submit","form[data-ajax=true]",function(t){var a=e(this).data(s)||[],n=e(this).data(d),o=n&&n.hasClass("cancel");t.preventDefault(),(o||r(this))&&l(this,{url:this.action,type:this.method||"GET",data:a.concat(e(this).serializeArray())})})}(jQuery);var GAddressMap={Map:null,IsLoaded:!1,deaultLatLng:null,scrollwheel:!0,minZoom:12,mapChangeCallBack:null,autocompleteElement:null,defaultAddress:"",_Extend:function(e){GAddressMap.deaultLatLng=e.deaultLatLng,GAddressMap.defaultZoom=e.defaultZoom,GAddressMap.scrollwheel=e.scrollwheel,GAddressMap.minZoom=e.minZoom,GAddressMap.mapChangeCallBack=e.mapChangeCallBack,GAddressMap.IsLoaded=!1,GAddressMap.autocompleteElement=document.querySelector(e.autocompleteElementSelector),GAddressMap.defaultAddress=e.defaultAddress||"",GAddressMap.geocoder=new google.maps.Geocoder;var t=document.querySelector(e.mapElementSelector),a=e.deaultLatLng||new google.maps.LatLng(10.823099,106.629664);GAddressMap.defaultAddress&&GAddressMap.geocoder.geocode({address:GAddressMap.defaultAddress},function(e,t){"OK"===t&&e[0]&&(a=e[0].geometry.location,GAddressMap.deaultLatLng||GAddressMap.Map.setCenter(a))}),GAddressMap.Map=new google.maps.Map(t,{center:a,zoom:GAddressMap.defaultZoom,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,zoomControl:!0,panControl:!1,scaleControl:!1,streetViewControl:!1,scrollwheel:!1,minZoom:GAddressMap.minZoom,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),GAddressMap.searchBox=new google.maps.places.SearchBox(GAddressMap.autocompleteElement),GAddressMap.searchBox.addListener("places_changed",function(){console.log("Place Change");var e=GAddressMap.searchBox.getPlaces();if(console.log(e),e&&0!==e.length){var t=e[0];if(!t.geometry)return void console.log("Returned place contains no geometry");GAddressMap.Map.setCenter(t.geometry.location),GAddressMap.Map.setZoom(GAddressMap.defaultZoom)}})},FirePlaceChange:function(e){GAddressMap.geocoder.geocode({address:e},function(e,t){t===google.maps.GeocoderStatus.OK&&e[0]&&GAddressMap.Map.setCenter(e[0].geometry.location)})},LoadMap:function(){GAddressMap.IsLoaded=!0,GAddressMap.Map.addListener("idle",function(){console.log("idle"),GAddressMap.searchBox.setBounds(GAddressMap.Map.getBounds()),GAddressMap.geocoder.geocode({location:GAddressMap.Map.getCenter()},function(e,t){"OK"===t&&e[0]&&(GAddressMap.mapChangeCallBack(GAddressMap.Map.getCenter(),e[0].formatted_address,e),GAddressMap.autocompleteElement.value=e[0].formatted_address)})})},Init:function(e){GAddressMap._Extend(e)}},moneyCleave,streetAddress,realAddress,autoCompleteAddress,lbAddress,locationId,price,lbPriceDisplay,maxImage,displayAddressLat,displayAddressLng,geoComponent,selectedPropertyType,quill,notes,btnGetMyLocation,lbHomeSize,fuzzyComplete,stogare,toolbarOptions=[[{font:["","serif","monospace"]}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],["clean"],[{align:[]}],["bold","italic","underline","strike"],["blockquote","code-block"],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}]];document.addEventListener("DOMContentLoaded",function(){init(),loadCleave(),Site.RemoveDefaultNumberInputField();var e=JSON.parse(realAddress.dataset.proptypes);fuzzyComplete=new BcFuzzySearch,fuzzyComplete.Init("#RealAddress",null,"","address","id",LocalStogeEnum.ALL_PLACES,bindingDataCompleteCallBack,bindingDataFailedCallback,selectionCallback081517,"#LocationId",10,3,e),Site.InputNumberMaxValue();var t=new FileUpload;t.Init(null,null,"#imagesUpload",null,"#imageReviews","#frmSearchPlace",6,inputFileCallBack,!0),LoadEditor()});